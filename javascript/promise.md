# 자바스크립트 Promise

## Promise란 무엇인가요?

### 콜백 함수

`Promise`, `async/await`과 같은 비동기 처리 방식이 있기 전에는 비동기 처리 결과에 대한 **후속 처리**를 하기 위해 **콜백 함수**를 사용했다.

> 이벤트 루프에 의해 콜스택이 비었을 때, 비동기 처리 함수가 콜스택에 푸시되어 실행되기 때문에 비동기 처리 결과는 외부로 반환하거나, 상위 스코프의 변수에 저장할 수 없다.

그러나 비동기 처리 결과에 대한 후속 처리의 결과를 **또 다시 후속 처리**하기 위해선 콜백 함수를 추가로 작성해야 하며, 이는 **콜백 헬**을 야기한다.

또한, 에러 처리가 곤란하다는 단점이 존재한다.

```javascript
try {
  setTimeout(() => {
    throw new Error('error');
  }, 1000);
} catch (e) {
  console.error('캐치 에러', e);
}
```

위의 예제에서는 try 코드 블록 내에서 1초 후 에러를 발생하는 setTimeout 함수를 실행한다.

setTimeout 함수의 콜백 함수는 **비동기적**으로 동작하므로 콜스택이 비었을 때 콜백 함수가 실행된다.

그러므로, 위의 예제에서는 catch 코드 블록 내에서 **에러를 처리할 수 없다.**

이러한 문제를 해결하기 위해 `Promise`가 만들어졌다.

### Promise

`Promise` 객체는 비동기적인 작업을 처리하는 데 사용되는 객체로, 비동기 처리 결과에 따라 `완료(resolve)` 혹은 `실패(reject)` 처리할 수 있는 콜백 함수를 가진다.

`Promise` 객체는 `then`, `catch`, `finally`와 같은 후속 처리 메소드를 이용하여 비동기 결과에 대한 후속 작업을 진행하기 때문에 콜백 헬에서 자유롭다.

또한, `catch` 메소드를 사용하여 에러를 쉽게 처리할 수 있다.

```javascript
const url = 'https://jsonplaceholder.typicode.com';

promiseGet(`${url}/posts/1`)
  .then(({ userId }) => promiseGet(`${url}/users/${userId}`))
  .then(console.log)
  .catch(console.error);
```

후속 처리 메소드는 항상 프로미스를 반환하기 때문에 위의 예제처럼 연속적으로 호출할 수 있으며 이를 `프로미스 체이닝`이라 한다.

> 만약 후속 처리 메소드의 콜백함수가 프로미스가 아닌 값을 반환하더라도 그 값을 암묵적으로 resolve 혹은 reject하여 프로미스를 생성해서 반환한다.

<br />

## Promise의 상태는 어떤 것들이 있나요?

**pending**
아직 비동기 처리가 **수행되지 않은** 상태

**fulfilled**
비동기 처리가 **성공**적으로 수행된 상태
`then` 메소드의 **첫번째 인수**(콜백 함수)를 통해 후속 처리를 진행할 수 있다.

**rejected**
비동기 처리가 **실패**로 수행된 상태
then 메소드의 **두번째 인수**(콜백 함수)로 처리하거나, `catch` 메소드를 사용하여 에러 처리를 진행할 수 있다.

<br />

## Promise 정적 메소드는 어떤 것들이 있나요?

5가지 정적 메소드가 존재한다.

**Promise.resolve**
인수로 전달받은 값을 `resolve`하는 프로미스를 생성한다.

**Promise.reject**
인수로 전달받은 값을 `reject`하는 프로미스를 생성한다.

**Promise.all**
여러 개의 비동기 작업을 `병렬 처리`할 때 사용한다.
모두 `fulfilled` 처리되었을 때, 처리 결과를 배열에 저장하여 새로운 프로미스를 반환한다.
인수로 `이터러블`을 전달받으며, 반환된 배열의 처리 순서(완료 순서 X)는 보장된다.
즉, 비동기 처리가 완료된 순서와 관계 없이 인수로 전달받은 이터러블 순서대로 배열을 반환한다.
하나라도 `reject`될 경우 **즉시 종료**된다.

**Promise.race**
여러개의 비동기 작업 중 **가장 먼저** `fulfilled` 처리된 프로미스를 반환한다.
**Promise.all**과 마찬가지로 하나라도 `reject`될 경우 **즉시 종료**된다.

**Promise.allSettled**
여러 개의 비동기 작업을 `병렬 처리`할 때 사용한다.
**Promise.all**과 달리 모두 `settled` 상태일 때, 처리 결과를 배열에 저장하여 새로운 프로미스를 반환한다.
