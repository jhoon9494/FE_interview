# 자바스크립트 실행컨텍스트

## 자바스크립트의 실행컨텍스트란 무엇인가요?

실행 컨텍스트는 소스코드를 실행하는데 필요한 `환경을 제공`하고, 코드의 `실행 결과를 관리`하는 영역이다.

즉, 모든 코드는 실행 컨텍스트를 통해 실행되고 관리된다.

이 중 식별자, 스코프, this 등은 실행 컨텍스트의 `렉시컬 환경`을 기반으로 관리되며, 코드의 실행순서는 `콜스택`(실행 컨텍스트 스택)을 통해서 관리된다.

모든 실행 컨텍스트는 평가와 실행의 과정을 거쳐서 생성되고 관리된다.

1. 평가 과정

   실행 컨텍스트를 생성하고 변수, 함수 등의 선언문을 파악해서 현재 스코프 내에서 사용할 수 있는 변수, 함수의 식별자를 실행 컨텍스트에 등록하는 과정

   해당 과정이 끝나면 선언문을 제외한 소스코드가 순차적으로 실행된다.

2. 실행 과정(런타임)

   소스코드 실행에 필요한 정보, 즉 변수나 함수의 참조를 실행 컨텍스트에서 찾고 실행과정에서 일어나는 변수값의 변경 등은 다시 실행 컨텍스트에 등록된다.

<br />

## 실행 컨텍스트의 종류는 무엇이 있나요?

1. 전역 실행 컨텍스트 (Global Execution Context)

   처음으로 자바스크립트 코드가 실행될 때 생성되는 실행 컨텍스트

   전역에서 관리되는 값들(함수나 별도 모듈로 분리되어 있지 않은 값)을 관리한다.

2. 함수 실행 컨텍스트 (Function Execution Context)

   `함수가 호출될 때` 마다 생성되는 실행 컨텍스트

   호출된 함수마다 각자의 실행 컨텍스트를 생성하고 가지게 된다.

그 외에도 Eval Execution Context와 Module Execution Context가 존재한다.

<br />

## 콜스택은 무엇인가요?

스택은 `LIFO(Last In, First Out)`의 특징을 가진 자료구조이다.

자바스크립트는 스택에 실행 컨텍스트를 순차적으로 추가하고 제거하면서 코드의 순서를 관리 및 실행한다.

<br />

## 실행 컨텍스트의 구조

### LexicalEnvironment(렉시컬 환경)

스코프를 관리하는 역할을 수행하며, 이 안에 변수, 함수의 정의와 값들이 저장된다.

아래는 렉시컬 환경을 구성하는 공통적인 두가지 요소이다.

#### `EnvironmentRecord(환경 레코드)`

식별자를 등록하고 관리하는 역할

#### `OuterLexicalEnvironmentReference(외부 렉시컬 환경에 대한 참조)`

상위 스코프를 참조하는 역할, 이를 통해 상위 영역에 있는 식별자에도 접근할 수 있게 된다.

### 전역 실행 컨텍스트의 구조

전역 렉시컬 환경의 전역 환경 레코드는 두가지 프로퍼티를 가지고 있다.

#### `Declarative Environment Record`(선언적 환경 레코드)

- let, const로 선언한 변수를 관리한다.

#### `ObjectEnvironmentRecord`(객체 환경 레코드)

- 그 외의 영역(var, 전역 함수, 빌트인 프로퍼티 등)을 관리한다.
- 객체 환경 레코드안의 `BindingObject` 프로퍼티에서 전역 객체를 참조한다.

전역 실행 컨텍스트의 this값에 대한 참조는 전역 환경 레코드의 `GlobalThisValue`라는 프로퍼티에 저장된다.

전역 실행 컨텍스트는 그 자체가 최상위 스코프이므로 `외부 렉시컬 환경에 대한 참조` 값은 null이다.

### 함수 실행 컨텍스트의 구조

#### `FunctionEnvironmentRecrod`(함수 환경 레코드)

- `매개변수`와 함수 내부에서 생성된 `지역 변수` 그리고 `중첩 함수` 등이 여기에 저장된다.

함수 실행 컨텍스트의 this 참조 값은 함수가 호출되는 상황에 따라서 결정되며 `ThisValue` 프로퍼티에 저장된다.

함수의 선언문이 평가되는 시점의 `실행 중인 실행 컨텍스트`가 함수의 `외부 렉시컬 환경에 대한 참조` 값이 된다.

함수의 실행 컨텍스트는 함수의 호출 시점에 생성되지만, 함수의 외부 렉시컬 환경에 대한 참조는 어디서 정의되었는지에 따라서 결정된다.
